<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>concurrent | LuXuanyu</title><meta name="keywords" content="C++"><meta name="author" content="Xuanyu Lu"><meta name="copyright" content="Xuanyu Lu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ConcurrencyConceptThe concurrency is developed because of the improvement of hardware so that people can run several processes simultaneously and several threads in each process. However, as the speed">
<meta property="og:type" content="article">
<meta property="og:title" content="concurrent">
<meta property="og:url" content="https://william-lu-stack.github.io/2021/03/03/concurrent/index.html">
<meta property="og:site_name" content="LuXuanyu">
<meta property="og:description" content="ConcurrencyConceptThe concurrency is developed because of the improvement of hardware so that people can run several processes simultaneously and several threads in each process. However, as the speed">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&risl=&pid=ImgRaw">
<meta property="article:published_time" content="2021-03-03T14:21:30.196Z">
<meta property="article:modified_time" content="2021-03-04T06:00:07.053Z">
<meta property="article:author" content="Xuanyu Lu">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&risl=&pid=ImgRaw"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://william-lu-stack.github.io/2021/03/03/concurrent/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="yandex-verification" content="{&quot;theme_color&quot;:{&quot;enable&quot;:true,&quot;main&quot;:&quot;#49B1F5&quot;,&quot;paginator&quot;:&quot;#00c4b6&quot;,&quot;button_hover&quot;:&quot;#FF7242&quot;,&quot;text_selection&quot;:&quot;#00c4b6&quot;,&quot;link_color&quot;:&quot;#99a9bf&quot;,&quot;meta_color&quot;:&quot;#858585&quot;,&quot;hr_color&quot;:&quot;#A4D8FA&quot;,&quot;code_foreground&quot;:&quot;#F47466&quot;,&quot;code_background&quot;:&quot;rgba(27, 31, 35, .05)&quot;,&quot;toc_color&quot;:&quot;#00c4b6&quot;,&quot;blockquote_padding_color&quot;:&quot;#49b1f5&quot;,&quot;blockquote_background_color&quot;:&quot;#49b1f5&quot;}}"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: '',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: Xuanyu Lu","link":"Link: ","source":"Source: LuXuanyu","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-04 14:00:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="/img/icon"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&amp;riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&amp;ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&amp;risl=&amp;pid=ImgRaw')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">LuXuanyu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">concurrent</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-categories"><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/project/">project</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">2.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>16min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h1><h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><p>The concurrency is developed because of the improvement of hardware so that people can run several processes simultaneously and several threads in each process. However, as the speed of computation is too fast to control, threads’ sequence cannot be predicted. This will cause problems like when a depositor tries to save a sum of money to the bank, the bank needs to make sure the account to be saved is accurate. If right now lots of depositor tries to save money to the bank at the same time, the bank may make mistakes that money goes to different account. This kind of things are called critical section. The critical section only be entered with one thread and then this section will be locked. C++ supports libraries to finish this ‘lock’ and ‘unlock’ move. We will see below.</p>
<h2 id="Concurrent-system"><a href="#Concurrent-system" class="headerlink" title="Concurrent system"></a>Concurrent system</h2><p>I found a basic concurrent system that can explain the concurrency well and I will show how to control the threads when critical section is met.</p>
<p><img src= "/img/loading.gif" data-lazy-src="/.io//concurrent.png"><br>The picture above is a embedded computer system which is responsible for gathering environmental data from the sensors, and then process it and transmit to the reciever. As the sensors only transmit data so it needs to make sure the type of data is not mistaken, so the Bus Controller should ensure each time only one sensor’s data collects(thread). Each thread should gain sole access to the Bus Controller to acqure data. The Link Access Controller is similar to the Bus Controller.</p>
<h2 id="Initiate-the-global-variables-which-could-help-us-simulate-this-system-easier"><a href="#Initiate-the-global-variables-which-could-help-us-simulate-this-system-easier" class="headerlink" title="Initiate the global variables which could help us simulate this system easier"></a>Initiate the global variables which could help us simulate this system easier</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int CountTempSensor &#x3D; 0;</span><br><span class="line">int CountPressureSensor &#x3D; 0;</span><br><span class="line">int CountCapacitiveSensor &#x3D; 0;</span><br><span class="line"></span><br><span class="line">std::map&lt;std::thread::id, int&gt; threadIDs;&#x2F;&#x2F;declare the map to ensure thread_id is incrementing from 0</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;global constants:</span><br><span class="line">int const MAX_NUM_OF_THREADS &#x3D; 6;</span><br><span class="line">int const NUM_OF_SAMPLES &#x3D; 50;</span><br><span class="line">int const NUM_OF_LINKS &#x3D; 2;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Trying 50 samples first and see the output.</p>
<h2 id="Simulate-the-Sensor"><a href="#Simulate-the-Sensor" class="headerlink" title="Simulate the Sensor"></a>Simulate the Sensor</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Sensor &#123; &#x2F;&#x2F;abstract base class that models a sensor</span><br><span class="line">public:</span><br><span class="line">    Sensor(string&amp; type) : sensorType(type) &#123;&#125;   &#x2F;&#x2F;constructor</span><br><span class="line">    &#x2F;&#x2F;Declare a virtual method to be overridden by derived classes:</span><br><span class="line">    virtual double getValue() &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F;Declare non-virtual method:</span><br><span class="line">    string getType() &#123;</span><br><span class="line">    &#x2F;&#x2F;returns the type of Sensor that this is:</span><br><span class="line">    return sensorType;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;Declare any instance variable(s):</span><br><span class="line">private:</span><br><span class="line">    string sensorType;</span><br><span class="line">&#125;; &#x2F;&#x2F;end abstract class Sensor</span><br></pre></td></tr></table></figure>
<p>As above said each time the data transfer from sensors to the Bus Controller we need to ensure the type of this data. The getType() function will helps us know it by using the inherit class sensors, like below.</p>
<h3 id="Temperature-Sensor"><a href="#Temperature-Sensor" class="headerlink" title="Temperature Sensor"></a>Temperature Sensor</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class TempSensor : public Sensor &#123;</span><br><span class="line">public:</span><br><span class="line">    &#x2F;&#x2F;syntax declares a derived class</span><br><span class="line">    TempSensor (string&amp; s) : Sensor(s) &#123;&#125; &#x2F;&#x2F;constructor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    virtual double getValue() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;return a random value of ambient temperature between 10 and 30</span><br><span class="line">        return random(10.000, 30.000);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;number range from 10-30</span><br><span class="line">    &#125; &#x2F;&#x2F;end getValue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>

<h3 id="Pressure-Sensor"><a href="#Pressure-Sensor" class="headerlink" title="Pressure Sensor"></a>Pressure Sensor</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class PressureSensor : public Sensor &#123;</span><br><span class="line">public:</span><br><span class="line">    &#x2F;&#x2F;syntax declares a derived class</span><br><span class="line">    PressureSensor (string&amp; s) : Sensor(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    virtual double getValue()&#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;return a random value of ambient pressure between 95 and 105</span><br><span class="line">        return random(95.000, 105.000);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>

<h3 id="Capactive-Sensor"><a href="#Capactive-Sensor" class="headerlink" title="Capactive Sensor"></a>Capactive Sensor</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class CapacitiveSensor : public Sensor &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">    CapacitiveSensor (string&amp; s) : Sensor(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    virtual double getValue()&#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;number range from 1-5</span><br><span class="line">        return random(1.000, 5.000);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>

<p>Each sensor gives a random value(reasonable, data is from google) that will generate.</p>
<h2 id="Initiate-the-Bus-Controller"><a href="#Initiate-the-Bus-Controller" class="headerlink" title="Initiate the Bus Controller"></a>Initiate the Bus Controller</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class BC &#123;</span><br><span class="line">public:</span><br><span class="line">    &#x2F;&#x2F;constructor: initialises a vector of Sensor pointers that are</span><br><span class="line">    &#x2F;&#x2F;passed in by reference:</span><br><span class="line">    BC(std::vector&lt;Sensor*&gt;&amp; sensors): theSensors(sensors) &#123;&#125;</span><br><span class="line">    void requestBC() &#123;</span><br><span class="line">        &#x2F;&#x2F;lock the mutex</span><br><span class="line">        std::unique_lock&lt;std::mutex&gt; lk(BC_mu);</span><br><span class="line">        while(lock)&#123;</span><br><span class="line">            &#x2F;&#x2F; print the present thread is going to suspend</span><br><span class="line">            cout &lt;&lt; &quot;BusController is locked, thread &quot;&lt;&lt; pairid() &lt;&lt; &quot; is about to suspend...&quot;&lt;&lt;endl;</span><br><span class="line">            cv.wait(lk);&#x2F;&#x2F; suspend the calling thread</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;to lock the BC</span><br><span class="line">        lock &#x3D; true;</span><br><span class="line">        cout &lt;&lt; &quot;BusController is locked by thread &quot;&lt;&lt;pairid() &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    double getSensorValue(int selector) &#123;</span><br><span class="line">        return (*theSensors[selector]).getValue();</span><br><span class="line">    &#125;</span><br><span class="line">    string getSensorType(int selector) &#123;</span><br><span class="line">        return (*theSensors[selector]).getType();</span><br><span class="line">    &#125;</span><br><span class="line">    void releaseBC() &#123;</span><br><span class="line">        &#x2F;&#x2F;lock the mutex</span><br><span class="line">        std::unique_lock&lt;std::mutex&gt; lk(BC_mu);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;unlock the BC</span><br><span class="line">        lock &#x3D; false;</span><br><span class="line">        cout &lt;&lt; &quot;BusController is unlocked by thread &quot;&lt;&lt;pairid() &lt;&lt;endl;</span><br><span class="line">        cv.notify_all(); &#x2F;&#x2F;resumes all threads waiting on the cv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    bool lock &#x3D; false;</span><br><span class="line">    &#x2F;&#x2F;&#39;false&#39; means that the BC is not locked</span><br><span class="line">    std::vector&lt;Sensor*&gt;&amp; theSensors; &#x2F;&#x2F;reference to vector of Sensor pointers</span><br><span class="line">    std::mutex BC_mu; &#x2F;&#x2F;declare a mutex</span><br><span class="line">    std::condition_variable cv;&#x2F;&#x2F;declare a condition variable to reach ME</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>

<p>This time for controlling the critical section’s entrance, I use the mutex and condition variable to reach the mutual exclusion to suspend other threads when one thread enters the BC.</p>
<h3 id="pairID-is-for-finding-the-exact-thread-because-of-the-use-of-map-above"><a href="#pairID-is-for-finding-the-exact-thread-because-of-the-use-of-map-above" class="headerlink" title="pairID() is for finding the exact thread because of the use of map above"></a>pairID() is for finding the exact thread because of the use of map above</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int pairid()&#123;</span><br><span class="line">    std::map &lt;std::thread::id, int&gt;::iterator it&#x3D; threadIDs.find(std::this_thread::get_id());</span><br><span class="line">    if (it &#x3D;&#x3D; threadIDs.end())&#123; return -1; &#125; &#x2F;&#x2F;thread &#39;id&#39; NOT found</span><br><span class="line">    else&#123; return it-&gt;second;&#125; &#x2F;&#x2F;thread &#39;id&#39; found, return the</span><br><span class="line">    &#x2F;&#x2F;associated integer –note the syntax.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Initiate-a-class-to-save-the-SensorData"><a href="#Initiate-a-class-to-save-the-SensorData" class="headerlink" title="Initiate a class to save the SensorData"></a>Initiate a class to save the SensorData</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class SensorData &#123; &#x2F;&#x2F;Utility class to store sensor data</span><br><span class="line">public:</span><br><span class="line">    SensorData(string type) : sensor_type(type) &#123;&#125;&#x2F;&#x2F;Constructor</span><br><span class="line">    string getSensorType() &#123;return sensor_type;&#125;</span><br><span class="line">    std::vector&lt;double&gt; getSensorData() &#123;return sensor_data;&#125;</span><br><span class="line">    void addData(double newData) &#123;sensor_data.push_back(newData);&#125;</span><br><span class="line">private:</span><br><span class="line">    string sensor_type;</span><br><span class="line">    std::vector&lt;double&gt; sensor_data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>This class is to iniate a vector to save the sensor data so that I do not need to initiate an array with volume set because vector’s volume could grow with the data amount grows.</p>
<h2 id="Simulate-the-receiver"><a href="#Simulate-the-receiver" class="headerlink" title="Simulate the receiver"></a>Simulate the receiver</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Receiver &#123;</span><br><span class="line"> public:</span><br><span class="line">    Receiver () &#123; &#125; &#x2F;&#x2F;constructor</span><br><span class="line">    &#x2F;&#x2F;Receives a SensorData object:</span><br><span class="line">    void receiveData(SensorData&amp; sd) &#123;</span><br><span class="line"></span><br><span class="line">        mu.lock();</span><br><span class="line"></span><br><span class="line">        std::vector&lt;double&gt; tmp &#x3D; sd.getSensorData(); &#x2F;&#x2F; tmp vector to store sensor data</span><br><span class="line">        string type &#x3D; sd.getSensorType();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;lock when both links using</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;save the data</span><br><span class="line">        if (&quot;temperature sensor&quot; &#x3D;&#x3D; type) &#123; &#x2F;&#x2F;tempsensor_data</span><br><span class="line">            temp_data.insert(temp_data.end(), tmp.begin(), tmp.end()); &#x2F;&#x2F; merge the vector</span><br><span class="line">        &#125;</span><br><span class="line">        else if (&quot;pressure sensor&quot; &#x3D;&#x3D; type) &#123; &#x2F;&#x2F;pressuresensor_data</span><br><span class="line">            pressure_data.insert(pressure_data.end(), tmp.begin(), tmp.end()); &#x2F;&#x2F;merge</span><br><span class="line">        &#125;</span><br><span class="line">        else if (&quot;capacitive sensor&quot; &#x3D;&#x3D;  type) &#123; &#x2F;&#x2F;capacitivesensor_data&#125;</span><br><span class="line">            capacitive_data.insert(capacitive_data.end(), tmp.begin(), tmp.end()); &#x2F;&#x2F;merge</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mu.unlock();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; print out all data for each sensor:</span><br><span class="line">    void printSensorData () &#123;</span><br><span class="line">        std::stringstream transfer; &#x2F;&#x2F;transfer to string for mutex printing after</span><br><span class="line"></span><br><span class="line">        mu.lock();&#x2F;&#x2F;lock mutex for output seperately</span><br><span class="line">        cout&lt;&lt;&quot;Temperature data: &quot;&lt;&lt;endl;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; CountTempSensor; i++)&#123;</span><br><span class="line">            &#x2F;&#x2F;print temp_sensor data</span><br><span class="line">            transfer&lt;&lt;temp_data[i]&lt;&lt;&quot;,&quot;;</span><br><span class="line">            print(transfer.str());</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">        mu.unlock();</span><br><span class="line"></span><br><span class="line">        mu.lock();&#x2F;&#x2F;same as above</span><br><span class="line">        cout&lt;&lt;&quot;Pressure data: &quot;&lt;&lt;endl;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; CountPressureSensor; i++)&#123;</span><br><span class="line">            &#x2F;&#x2F;print pressure_sensor data</span><br><span class="line">            transfer&lt;&lt;pressure_data[i]&lt;&lt;&quot;,&quot;;</span><br><span class="line">            print(transfer.str());</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">        mu.unlock();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mu.lock();&#x2F;&#x2F;same as above</span><br><span class="line">        cout&lt;&lt;&quot;Capacitive data: &quot;&lt;&lt;endl;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; CountCapacitiveSensor; i++)&#123;</span><br><span class="line">            &#x2F;&#x2F;print capacitive_sensor data</span><br><span class="line">            transfer&lt;&lt;capacitive_data[i]&lt;&lt;&quot;,&quot;;</span><br><span class="line">            print(transfer.str());</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">        mu.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"> private:</span><br><span class="line">    &#x2F;&#x2F;mutex:</span><br><span class="line">    std::mutex mu;</span><br><span class="line">    std::condition_variable cv;</span><br><span class="line">    &#x2F;&#x2F;vectors to store sensor numeric data received from threads:</span><br><span class="line">    std::vector&lt;double&gt; temp_data; &#x2F;&#x2F;TempSensor</span><br><span class="line">    std::vector&lt;double&gt; pressure_data; &#x2F;&#x2F;PressureSensor</span><br><span class="line">    std::vector&lt;double&gt; capacitive_data; &#x2F;&#x2F;CapacitiveSensor</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>This class uses the type of sensor data return to recoginize the categories of data and then print it out. To ensure the print part will not be affected by the thread, I added another print function print() to make the print reach mutual exclusion either.</p>
<h3 id="print"><a href="#print" class="headerlink" title="print()"></a>print()</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void print(string str)&#123;&#x2F;&#x2F; for ensure the cout doesnt interleave</span><br><span class="line">    std::mutex mu;</span><br><span class="line">    mu.lock();</span><br><span class="line">    cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line">    mu.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> Then the vector with mutex could ennsure each type of data is printed orderly.<br> It will print like: TempSensor: [……], PressureSensor:[……], CapactiveSensor:[……].</p>
<p> Now the BC’s part has now been completed,  what left is to implement the Link part.</p>
<h2 id="Simulate-the-Link-access-controller"><a href="#Simulate-the-Link-access-controller" class="headerlink" title="Simulate the Link access controller"></a>Simulate the Link access controller</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> class LinkAccessController &#123;</span><br><span class="line"> public:</span><br><span class="line">    LinkAccessController(Receiver&amp; r) &#x2F;&#x2F;Constructor</span><br><span class="line">    : myReceiver(r), numOfAvailableLinks(NUM_OF_LINKS)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; NUM_OF_LINKS; i++) &#123;</span><br><span class="line">            commsLinks.push_back(Link(myReceiver, i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#x2F;&#x2F;Request a comm&#39;s link: returns a reference to an available Link.</span><br><span class="line"> &#x2F;&#x2F;If none are available, the calling thread is suspended.</span><br><span class="line">    Link&amp; requestLink() &#123;</span><br><span class="line"></span><br><span class="line">        std::unique_lock&lt;std::mutex&gt; lk(LAC_mu);</span><br><span class="line">        int LinkNum &#x3D; 1;&#x2F;&#x2F; initialize linknum except 0 or 1.</span><br><span class="line"></span><br><span class="line">        if (numOfAvailableLinks &gt; 0)&#123;</span><br><span class="line">             numOfAvailableLinks--; &#x2F;&#x2F;semaphore -1</span><br><span class="line"></span><br><span class="line">             if (commsLinks[0].isInUse() &#x3D;&#x3D; false) &#123;</span><br><span class="line">                LinkNum &#x3D; 0; &#x2F;&#x2F; use corresponding link</span><br><span class="line">                commsLinks[0].setInUse();</span><br><span class="line">                cout&lt;&lt; &quot;Thread &quot;&lt;&lt;pairid()&lt;&lt;&quot;is using link 0&quot;&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">             &#125;</span><br><span class="line">             else if (commsLinks[1].isInUse() &#x3D;&#x3D; false) &#123;</span><br><span class="line">                LinkNum &#x3D; 1; &#x2F;&#x2F; like above</span><br><span class="line">                commsLinks[1].setInUse();</span><br><span class="line">                cout&lt;&lt;&quot;Thread &quot;&lt;&lt;pairid()&lt;&lt;&quot;is using link 1&quot;&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">             &#125;</span><br><span class="line">             return std::ref(commsLinks[LinkNum]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        else &#123;</span><br><span class="line">            cout&lt;&lt; &quot;None of link is available, thread &quot; &lt;&lt; pairid() &lt;&lt;&quot; is suspended.&quot; &lt;&lt;endl;</span><br><span class="line">            vc.wait(lk); &#x2F;&#x2F;suspend the calling thread</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"> &#x2F;&#x2F;Release a comms link:</span><br><span class="line">    void releaseLink(Link&amp; releasedLink) &#123;</span><br><span class="line">        std::unique_lock&lt;std::mutex&gt; lk(LAC_mu); &#x2F;&#x2F;lock the mutex</span><br><span class="line">        std::stringstream transfer; &#x2F;&#x2F;transfer data type</span><br><span class="line">        numOfAvailableLinks++;&#x2F;&#x2F;semaphore + 1 first</span><br><span class="line">        releasedLink.setIdle();&#x2F;&#x2F;release the link</span><br><span class="line">        transfer &lt;&lt; &quot;Thread &quot;&lt;&lt; pairid() &lt;&lt; &quot; is released from link &quot; &lt;&lt; releasedLink.getLinkId() &lt;&lt;&quot;\n&quot;;</span><br><span class="line">        print(transfer.str()); &#x2F;&#x2F;all to string and ensure print atomatic</span><br><span class="line">        vc.notify_one();&#x2F;&#x2F;release one of the threads</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line"> Receiver&amp; myReceiver; &#x2F;&#x2F;Receiver reference</span><br><span class="line"> int numOfAvailableLinks;&#x2F;&#x2F;semaphore</span><br><span class="line"> std::vector&lt;Link&gt; commsLinks;</span><br><span class="line"> std::mutex LAC_mu; &#x2F;&#x2F;mutex</span><br><span class="line"> std::condition_variable vc;&#x2F;&#x2F;declare a condition variable</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This time use semaphores to control these two links to reach mutual exclusion. As in the above, it is usually to allow one thread to enter the critical section, but now using semaphores could allow more than one thread each time.<br>With the combination of mutex and condition variable could suspend other threads enter.</p>
<p>Finally, we can implement the whole simulation now. The details are below, just follow the diagram shows.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">void run(BC&amp; theBC, LinkAccessController&amp; lac,int idx) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::mutex mu; &#x2F;&#x2F;declare a mutex</span><br><span class="line">    std::unique_lock&lt;std::mutex&gt; map_locker(mu); &#x2F;&#x2F;lock the map via the mutex.</span><br><span class="line">    &#x2F;&#x2F;insert the threadID and id into the map:</span><br><span class="line">    threadIDs.insert(std::make_pair(std::this_thread::get_id(), idx));</span><br><span class="line">    map_locker.unlock(); &#x2F;&#x2F;we&#39;re done, unlock the map.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    SensorData TempData(&quot;temperature sensor&quot;);&#x2F;&#x2F; data for temperature</span><br><span class="line">    SensorData PreData(&quot;pressure sensor&quot;); &#x2F;&#x2F; data for pressure</span><br><span class="line">    SensorData CapData(&quot;capacitive sensor&quot;); &#x2F;&#x2F;data for capacitive</span><br><span class="line"></span><br><span class="line">    for (int i&#x3D;0; i&lt; NUM_OF_SAMPLES; i++) &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; request use of the BC:</span><br><span class="line">        theBC.requestBC();</span><br><span class="line">    &#x2F;&#x2F; generate a random value between 0 and 2, and use it t o</span><br><span class="line">        int selector &#x3D; rand()%3;</span><br><span class="line">    &#x2F;&#x2F; select a sensor and obtain a value and the sensor&#39;s type:</span><br><span class="line">        int thread_id &#x3D; pairid();</span><br><span class="line">        string type &#x3D; theBC.getSensorType(selector);</span><br><span class="line">        double value &#x3D; theBC.getSensorValue(selector);</span><br><span class="line"></span><br><span class="line">        std::stringstream transfer;</span><br><span class="line">        transfer &lt;&lt; &quot;       sample value from thread &quot; &lt;&lt; thread_id &lt;&lt; &quot; from &quot; &lt;&lt; type &lt;&lt; &quot; &#x3D; &quot; &lt;&lt; value &lt;&lt;&quot;\n&quot;;&#x2F;&#x2F;transfer all the data into string</span><br><span class="line">        print(transfer.str());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; increment counter for sensor chosen (to keep count of</span><br><span class="line">    &#x2F;&#x2F; how many times each was used)</span><br><span class="line">        if (selector &#x3D;&#x3D; 0)&#123;</span><br><span class="line">            CountTempSensor++;</span><br><span class="line">            TempData.addData(value);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (selector &#x3D;&#x3D; 1)&#123;</span><br><span class="line">            CountPressureSensor++;</span><br><span class="line">            PreData.addData(value);</span><br><span class="line">        &#125;</span><br><span class="line">        else if(selector &#x3D;&#x3D; 2)&#123;</span><br><span class="line">            CountCapacitiveSensor++;</span><br><span class="line">            CapData.addData(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; add data to corresponding sensor</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; release the BC:</span><br><span class="line">        theBC.releaseBC();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; delay for random period between 1 and 10 milliseconds:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        std::uniform_int_distribution&lt;&gt; dis(1, 10); &#x2F;&#x2F;set up the distribution</span><br><span class="line">        &#x2F;&#x2F;from which integers will be drawn.</span><br><span class="line">        int sleep &#x3D; dis(gen); &#x2F;&#x2F;generate a pseudo-random integer between 1-10.</span><br><span class="line">        std::this_thread::sleep_for (std::chrono::milliseconds(sleep));&#x2F;&#x2F;delay</span><br><span class="line"></span><br><span class="line">        DelayTime &#x3D; DelayTime + sleep;</span><br><span class="line"></span><br><span class="line">    &#125; &#x2F;&#x2F; end of for</span><br><span class="line"></span><br><span class="line">        Link* link &#x3D; &amp;lac.requestLink(); &#x2F;&#x2F;declare link</span><br><span class="line">        link-&gt; writeToDataLink(CapData);</span><br><span class="line">        link-&gt; writeToDataLink(PreData);</span><br><span class="line">        link-&gt; writeToDataLink(TempData);     &#x2F;&#x2F;note pointer syntax</span><br><span class="line">        lac.releaseLink(*link);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        std::uniform_int_distribution&lt;&gt; dis1(1, 10); &#x2F;&#x2F;set up the distribution</span><br><span class="line">        &#x2F;&#x2F;from which integers will be drawn.</span><br><span class="line">        int sleep1 &#x3D; dis1(gen); &#x2F;&#x2F;generate a pseudo-random integer between 1-10.</span><br><span class="line">        std::this_thread::sleep_for (std::chrono::milliseconds(sleep1));&#x2F;&#x2F;delay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        DelayTime &#x3D; DelayTime + sleep1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I also calculate the delay time which you can put it in the global variable or in the run(), depends on which you prefer.</p>
<p>As all finished , we can implement the main function to see how it works.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    srand(time(0)); &#x2F;&#x2F;initialization for random number</span><br><span class="line">   &#x2F;&#x2F;declare a vector of Sensor pointers:</span><br><span class="line">    std::vector&lt;Sensor*&gt; sensors;</span><br><span class="line">    &#x2F;&#x2F;initialise each sensor and insert into the vector:</span><br><span class="line">    string s &#x3D; &quot;temperature sensor&quot;;</span><br><span class="line">    sensors.push_back(new TempSensor(s)); &#x2F;&#x2F;push_back is a vector method.</span><br><span class="line">    string s1 &#x3D; &quot;pressure sensor&quot;;</span><br><span class="line">    sensors.push_back(new PressureSensor(s1));</span><br><span class="line">    string s2 &#x3D; &quot;capacitive sensor&quot;;</span><br><span class="line">    sensors.push_back(new CapacitiveSensor(s2));</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Instantiate the BC:</span><br><span class="line">    BC theBC(std::ref(sensors));</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Instantiate the Receiver:</span><br><span class="line">    Receiver receiver;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Instantiate the LinkAccessController:</span><br><span class="line">    LinkAccessController lac(receiver);</span><br><span class="line">    &#x2F;&#x2F;instantiate and start the threads:</span><br><span class="line">    std::thread the_threads[MAX_NUM_OF_THREADS]; &#x2F;&#x2F;array of threads</span><br><span class="line">    for (int i &#x3D; 0; i &lt; MAX_NUM_OF_THREADS; i++) &#123;</span><br><span class="line">    &#x2F;&#x2F;launch the threads:</span><br><span class="line">        the_threads[i] &#x3D; std::thread(run, std::ref(theBC), std::ref(lac), i);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;wait for the threads to finish:</span><br><span class="line">    for (int i &#x3D; 0; i &lt; MAX_NUM_OF_THREADS; i++) &#123;</span><br><span class="line">        the_threads[i].join();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Print out all the data in the Receiver:</span><br><span class="line">    receiver.printSensorData();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;All threads terminated&quot; &lt;&lt; endl;</span><br><span class="line">    &#x2F;&#x2F;print out the number of times each sensor was accessed:</span><br><span class="line">    cout &lt;&lt; &quot;count number of TempSensor &#x3D; &quot; &lt;&lt; CountTempSensor &lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; &quot;count number of PressureSensor &#x3D; &quot; &lt;&lt; CountPressureSensor &lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; &quot;count number of CapacitiveSensor &#x3D; &quot; &lt;&lt; CountCapacitiveSensor &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;Total time delay is &quot;&lt;&lt; DelayTime &lt;&lt;&quot;ms&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is a quite good project to understand how to use threads and mutual exclusion in my opinion.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Xuanyu Lu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://william-lu-stack.github.io/2021/03/03/concurrent/">https://william-lu-stack.github.io/2021/03/03/concurrent/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C++</a></div><div class="post_share"><div class="social-share" data-image="https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&amp;riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&amp;ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&amp;risl=&amp;pid=ImgRaw" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/02/BinaryTree/"><img class="prev-cover" data-lazy-src="https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&amp;riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&amp;ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&amp;risl=&amp;pid=ImgRaw" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">BinaryTree</div></div></a></div><div class="next-post pull-right"><a href="/2021/03/04/fakegram/"><img class="next-cover" data-lazy-src="https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&amp;riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&amp;ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&amp;risl=&amp;pid=ImgRaw" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">fakegram</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Xuanyu Lu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/William-Lu-stack"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/William-Lu-stack" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:luxuanyuwilliam@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Concurrency"><span class="toc-number">1.</span> <span class="toc-text">Concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Concept"><span class="toc-number">1.1.</span> <span class="toc-text">Concept</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Concurrent-system"><span class="toc-number">1.2.</span> <span class="toc-text">Concurrent system</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initiate-the-global-variables-which-could-help-us-simulate-this-system-easier"><span class="toc-number">1.3.</span> <span class="toc-text">Initiate the global variables which could help us simulate this system easier</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simulate-the-Sensor"><span class="toc-number">1.4.</span> <span class="toc-text">Simulate the Sensor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Temperature-Sensor"><span class="toc-number">1.4.1.</span> <span class="toc-text">Temperature Sensor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pressure-Sensor"><span class="toc-number">1.4.2.</span> <span class="toc-text">Pressure Sensor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Capactive-Sensor"><span class="toc-number">1.4.3.</span> <span class="toc-text">Capactive Sensor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initiate-the-Bus-Controller"><span class="toc-number">1.5.</span> <span class="toc-text">Initiate the Bus Controller</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pairID-is-for-finding-the-exact-thread-because-of-the-use-of-map-above"><span class="toc-number">1.5.1.</span> <span class="toc-text">pairID() is for finding the exact thread because of the use of map above</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initiate-a-class-to-save-the-SensorData"><span class="toc-number">1.6.</span> <span class="toc-text">Initiate a class to save the SensorData</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simulate-the-receiver"><span class="toc-number">1.7.</span> <span class="toc-text">Simulate the receiver</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#print"><span class="toc-number">1.7.1.</span> <span class="toc-text">print()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simulate-the-Link-access-controller"><span class="toc-number">1.8.</span> <span class="toc-text">Simulate the Link access controller</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://th.bing.com/th/id/R520b1f4596a8452b8f6d7c31577c0817?rik=zSGL9zeMmaRQ5g&amp;riu=http%3a%2f%2ffile06.16sucai.com%2f2016%2f0926%2f59bae37662e8f718957d0d8692306317.jpg&amp;ehk=mmFQgrXhn%2b5NrsEzgpa035wVCSd4%2fZaXV0fxQkFhIR0%3d&amp;risl=&amp;pid=ImgRaw')"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Xuanyu Lu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,I'm Lu, welcome to my <a href="https://William-Lu-stack.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">2</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>